/*! marionette-formview - v0.1.0 - 2012-10-08 */
(function(e,t){"use strict";typeof define=="function"&&define.amd?define(["marionette","jquery","underscore"],t):e.Marionette.FormView=t(e.Marionette,e.jQuery,e._)})(this,function(e,t,n){"use strict";var r=e.ItemView.extend({tagName:"form",className:"formView",defaults:{field:{validateOn:"submit"}},rules:{},fields:{},constructor:function(){e.ItemView.prototype.constructor.apply(this,arguments);if(!this.fields)throw new Error("Fields Must Be Provided");this.model||(this.model=new Backbone.Model),this.data&&this.model.set(this.data),this.template||this.runInitializers(),this.on("item:rendered",this.runInitializers,this)},populateFields:function(){n(this.fields).each(function(e,t){var n=this.model.get(t);this.$(e.el).data("model-attribute",t),typeof n=="undefined"&&(n=""),this.$(e.el).val(n)},this)},serializeFormData:function(){function t(t,n){var r=this.$(t.el);r&&(e[n]=r.val()||r.text()||"")}var e={};return n.each(this.fields,n(t).bind(this)),e},beforeFormSubmit:function(e){var t=this.validate(),r=n.isEmpty(t);r||n.isFunction(this.onSubmitError)&&this.onSubmitError.apply(this,[t]);if(n.isFunction(this.onSubmit))return this.onSubmit.apply(this,[e])},inputBlur:function(e){var n=e.target||e.srcElement,r=t(n).data("model-attribute"),i=this.fields[r],s=this.$(n).val();i&&i.validateOn==="blur"&&this.handleBlurValidation(r,n,s)},inputKeyUp:function(){},handleBlurValidation:function(e,t,r){var i={};i[e]=r;var s=this.validate(i);if(!n.isEmpty(s))return n.isFunction(this.onSubmitError)&&this.onSubmitError.call(this,s),!1},validate:function(e){var t=this,r={},i=n(this.fields).keys();return n(i).each(function(e){var t=this.validateField(e);n.isEmpty(t)||(r[e]=t)},this),r},validateField:function(e){var r=this.fields[e],i=r&&r.validations?r.validations:{},s=[],o,u=this.$(r.el),a;a=u&&(u.val?u.val():u.text())||"",a=t.trim(a),r.required?(o=this.validateRule(a,"required"),o||s.push("This field is required")):i&&n.each(i,function(e,t){o=this.validateRule(a,t),o||s.push(e)},this);if(!n.isEmpty(s)){var f={field:e,el:this.fields[e].el,error:s};return n.isFunction(this.onFieldError)&&this.onFieldError(f),f}},validateRule:function(e,t){var n;if(!t)throw new Error("Not passed a validation to test");return t==="required"?!!e:(t.indexOf(":")!==-1&&(n=t.split(":"),t=n.shift()),this.rules&&this.rules[t]?this.rules[t](e):i.validate(t,e,n))},submit:function(e){this.form.submit()},bindFormEvents:function(){var e=this.$el.is("form")?this.$el:this.$("form").first();this.form=e,this.$("input").blur(this.inputBlur.bind(this)).keyup(this.inputKeyUp.bind(this)),e.submit(this.beforeFormSubmit.bind(this))},runInitializers:function(){this.populateFields(),this.bindFormEvents()},getQueryParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);return r?decodeURIComponent(r[1].replace(/\+/g," ")):!1}}),i={regex:{email:/^[a-zA-Z0-9!#$%&'*\+\/=?\^_`{|}~\-]+(?:\\.[a-zA-Z0-9!#$%&'*\+\/=?\^_`{|}~\-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?\\.)+([a-zA-Z0-9]){2,3}$/,alpha:/^[a-zA-Z]+$/,alphanum:/^[a-zA-Z0-9]+$/},validate:function(e,t,r){if(n.isFunction(this[e]))return this[e](t,r);throw new Error("Validator does not exist - %s",e)},min:function(e,t){return e.length<t?!1:!0},max:function(e,t){return e.length>t?!1:!0},numeric:function(e){return n.isNumber(e)},alpha:function(e){return this.regex.alpha.test(e)},alphanum:function(e){return this.regex.alphanum.test(e)},email:function(e){return this.regex.email.test(e)},required:function(e){return n.isNull(e)||n.isUndefined(e)||n.isString(e)&&e.length===0?!1:!0},"boolean":function(e){return n.isBoolean(e)}};return r});